# Cyber Girlfriend - äº§å“éœ€æ±‚æ–‡æ¡£ (PRD)

**ç‰ˆæœ¬**: 1.0  
**æ—¥æœŸ**: 2025å¹´1æœˆ  
**çŠ¶æ€**: åˆç¨¿

---

## ä¸€ã€äº§å“æ¦‚è¿°

### 1.1 äº§å“å®šä½
Cyber Girlfriend æ˜¯ä¸€ä¸ª**æç®€ä¸»ä¹‰è¯­éŸ³äº¤äº’è™šæ‹Ÿä¼´ä¾£**åº”ç”¨ï¼Œé€šè¿‡ OpenAI çš„å®æ—¶è¯­éŸ³ API (Realtime API) æä¾›è‡ªç„¶ã€æµç•…çš„å¯¹è¯ä½“éªŒã€‚äº§å“æ ¸å¿ƒç†å¿µæ˜¯"Less is More"ï¼Œä¸“æ³¨äºæä¾›æœ€çº¯ç²¹çš„è¯­éŸ³äº¤äº’ä½“éªŒã€‚

### 1.2 äº§å“æ„¿æ™¯
æ‰“é€ ä¸€ä¸ªç®€å•ã€ä¼˜é›…ã€é«˜æ•ˆçš„AIè¯­éŸ³ä¼´ä¾£ï¼Œè®©ç”¨æˆ·é€šè¿‡æœ€è‡ªç„¶çš„æ–¹å¼â€”â€”è¯­éŸ³ï¼Œä¸AIå»ºç«‹æƒ…æ„Ÿè¿æ¥ã€‚

### 1.3 ç›®æ ‡ç”¨æˆ·
- **ä¸»è¦ç”¨æˆ·**: å¯»æ±‚æƒ…æ„Ÿé™ªä¼´å’Œå¯¹è¯ç»ƒä¹ çš„æˆå¹´ç”¨æˆ·ï¼ˆ18-35å²ï¼‰
- **æ¬¡è¦ç”¨æˆ·**: å¯¹AIè¯­éŸ³äº¤äº’æŠ€æœ¯æ„Ÿå…´è¶£çš„æŠ€æœ¯çˆ±å¥½è€…

### 1.4 æ ¸å¿ƒä»·å€¼ä¸»å¼ 
- **æç®€äº¤äº’**: ä¸€é”®å³è¯´ï¼Œé›¶å­¦ä¹ æˆæœ¬
- **ä¸ªæ€§å®šåˆ¶**: é€šè¿‡æç¤ºè¯å¡‘é€ ç‹¬ç‰¹çš„AIäººæ ¼
- **éšç§ä¿æŠ¤**: æœ¬åœ°éƒ¨ç½²é€‰é¡¹ï¼Œæ•°æ®å®Œå…¨è‡ªä¸»å¯æ§
- **å®æ—¶å“åº”**: ä½å»¶è¿Ÿã€é«˜è´¨é‡çš„è¯­éŸ³å¯¹è¯ä½“éªŒ

---

## äºŒã€åŠŸèƒ½éœ€æ±‚

### 2.1 æ ¸å¿ƒåŠŸèƒ½æ¨¡å—


### 2.1.1 è¯­éŸ³äº¤äº’ç³»ç»Ÿï¼ˆä¼˜åŒ–åäº¤äº’é€»è¾‘ï¼‰

**ä¼˜åŒ–äº¤äº’æ¨¡å¼**
- **æŒç»­å¯¹è¯æ¨¡å¼** (Toggle Interaction)
  - ç‚¹å‡»åœ†å½¢æŒ‰é’®åï¼ŒæŒ‰é’®é«˜äº®å˜è‰²ï¼ˆå¦‚é’è‰²/ç²‰è‰²å‘å…‰ï¼‰ï¼Œä»£è¡¨äº¤äº’å·²å¼€å¯ï¼Œåº”ç”¨è¿›å…¥â€œå¸¸å¼€â€çŠ¶æ€ï¼Œå¯è¿ç»­å¯¹è¯ï¼Œæ— éœ€æ¯æ¬¡æŒ‰ä½æˆ–è‡ªåŠ¨æ£€æµ‹ã€‚
  - åœ¨æ­¤çŠ¶æ€ä¸‹ï¼Œç”¨æˆ·ä¸AIå¯è‡ªç„¶ä¿æŒæµç•…äº¤äº’ï¼Œå¯¹è¯å®æ—¶æ˜¾ç¤ºåœ¨æ–‡å­—å¯¹è¯æµåŒºåŸŸã€‚
  - å†æ¬¡ç‚¹å‡»åœ†å½¢æŒ‰é’®ï¼ŒæŒ‰é’®å˜ä¸ºç°è‰²ï¼Œè¡¨ç¤ºäº¤äº’ç»“æŸï¼Œåº”ç”¨åœæ­¢æ”¶å¬ä¸å“åº”ã€‚

**å†å²å¯¹è¯æ˜¾ç¤º**
- ä¸»ç•Œé¢åº•éƒ¨åŒºåŸŸæ–°å¢â€œå¯¹è¯æµæ–‡å­—â€åŒºåŸŸï¼Œä»¥æ¶ˆæ¯æ°”æ³¡æˆ–ç®€æ´è¡Œæ–‡å½¢å¼ï¼Œå®æ—¶æ˜¾ç¤ºåŒå‘æ–‡å­—å†…å®¹ã€‚
- ç”¨æˆ·å¯æ»šåŠ¨æŸ¥çœ‹å†å²äº¤äº’ï¼Œæ”¯æŒå¿«é€Ÿå®šä½æœ€è¿‘ä¸€è½®å¯¹è¯ã€‚
- å†å²å¯¹è¯ä¸è¯­éŸ³æ³¢å½¢å¯è§†åŒ–äº’ä¸å¹²æ‰°ã€‚

**å“åº”ç­‰å¾…è®¾è®¡**
- AIå¤„ç†æˆ–ç”Ÿæˆå›å¤æ—¶ï¼Œä¸»ç•Œé¢æ˜¾ç¤ºâ€œæ­£åœ¨å›åº”...â€çš„å¾®åŠ¨ç”»ï¼ˆå¦‚å‘¼å¸ç¯æ•ˆæœï¼‰ã€‚
- æä¾›ç®€çŸ­å»¶è¿Ÿæç¤ºï¼Œå‡å°‘ç”¨æˆ·ç­‰å¾…ç„¦è™‘ã€‚
- è‹¥è¶…æ—¶æˆ–å¼‚å¸¸ï¼Œæç¤ºâ€œè¿æ¥å¼‚å¸¸ï¼Œè¯·é‡è¯•â€ã€‚

#### ä¸»ç•Œé¢å¸ƒå±€ï¼ˆä¼˜åŒ–åï¼‰

```ascii
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Cyber Girlfriend               â”‚
â”‚   â— åœ¨çº¿çŠ¶æ€   â± 00:45 ä¼šè¯æ—¶é•¿    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        [éŸ³é¢‘æ³¢å½¢å¯è§†åŒ–åŒºåŸŸ]          â”‚
â”‚                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  å¯¹è¯æµæ–‡å­—æ˜¾ç¤ºï¼ˆæ»šåŠ¨åŒºåŸŸï¼‰  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                     â”‚
â”‚             â—¯   åˆ‡æ¢äº¤äº’æŒ‰é’®         â”‚
â”‚        ï¼ˆå½©è‰²=å¼€å¯ï¼Œç°è‰²=å…³é—­ï¼‰     â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âš™ï¸ è®¾ç½®  ğŸ“Š å†å²  ğŸ‘¤ äººæ ¼  â“ å¸®åŠ© â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


#### 2.1.2 ä¸ªæ€§åŒ–é…ç½®ç³»ç»Ÿ

**ç³»ç»Ÿæç¤ºè¯ç®¡ç†**
```markdown
åŠŸèƒ½è¦æ±‚:
- é¢„è®¾æ¨¡æ¿åº“ï¼ˆ5-10ä¸ªç²¾å¿ƒè®¾è®¡çš„äººæ ¼æ¨¡æ¿ï¼‰
- è‡ªå®šä¹‰ç¼–è¾‘å™¨ï¼Œæ”¯æŒ Markdown è¯­æ³•é«˜äº®
- å­—ç¬¦é™åˆ¶: æœ€å¤§ 2000 å­—ç¬¦
- å®æ—¶ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯ä¼šè¯
- ç‰ˆæœ¬ç®¡ç†: ä¿å­˜æœ€è¿‘5ä¸ªç‰ˆæœ¬
```

**é¢„è®¾äººæ ¼æ¨¡æ¿ç¤ºä¾‹**
```json
{
  "æ¸©æŸ”å‹": "ä½ æ˜¯ä¸€ä¸ªæ¸©æŸ”ä½“è´´çš„å¥³æœ‹å‹ï¼Œè¯´è¯è½»å£°ç»†è¯­...",
  "æ´»æ³¼å‹": "ä½ æ˜¯ä¸€ä¸ªå……æ»¡æ´»åŠ›çš„å¥³æœ‹å‹ï¼Œæ€§æ ¼å¼€æœ—...",
  "çŸ¥æ€§å‹": "ä½ æ˜¯ä¸€ä¸ªçŸ¥è¯†æ¸Šåšçš„å¥³æœ‹å‹ï¼Œå–œæ¬¢æ·±åº¦å¯¹è¯...",
  "å¾¡å§å‹": "ä½ æ˜¯ä¸€ä¸ªæˆç†Ÿç¨³é‡çš„å¥³æœ‹å‹ï¼Œæœ‰ä¸»è§...",
  "äºŒæ¬¡å…ƒ": "ä½ æ˜¯ä¸€ä¸ªå¯çˆ±çš„äºŒæ¬¡å…ƒå¥³æœ‹å‹ï¼Œå–œæ¬¢åŠ¨æ¼«..."
}
```

**è¯­éŸ³å‚æ•°é…ç½®**
- è¯­éŸ³æ¨¡å‹é€‰æ‹©: alloy, echo, fable, onyx, nova, shimmer
- è¯­é€Ÿè°ƒèŠ‚: 0.5x - 2.0x (æ­¥è¿›0.1)
- æ¸©åº¦å‚æ•°: 0.6 - 1.0 (åˆ›é€ æ€§æ§åˆ¶)
- å“åº”é•¿åº¦åå¥½: ç®€çŸ­/é€‚ä¸­/è¯¦ç»†

#### 2.1.3 æ•°æ®ç®¡ç†åŠŸèƒ½

**å¯¹è¯å†å²**
- è‡ªåŠ¨ä¿å­˜æ‰€æœ‰å¯¹è¯ï¼ˆæ–‡æœ¬å½¢å¼ï¼‰
- æ”¯æŒæœç´¢å’Œç­›é€‰
- æ ‡è®°é‡è¦å¯¹è¯
- æ‰¹é‡åˆ é™¤åŠŸèƒ½

**æ•°æ®å¯¼å‡º**
- æ ¼å¼æ”¯æŒ: JSON, TXT, CSV
- é€‰æ‹©æ€§å¯¼å‡º: æŒ‰æ—¥æœŸèŒƒå›´ã€æ ‡è®°çŠ¶æ€
- åŒ…å«å…ƒæ•°æ®: æ—¶é—´æˆ³ã€æƒ…ç»ªæ ‡ç­¾ã€ä¼šè¯ID

**éšç§æ§åˆ¶**
- æœ¬åœ°å­˜å‚¨ä¼˜å…ˆ
- ç«¯åˆ°ç«¯åŠ å¯†é€‰é¡¹
- å®šæœŸè‡ªåŠ¨æ¸…ç†ï¼ˆå¯é…ç½®å‘¨æœŸï¼‰
- åŒ¿åæ¨¡å¼ï¼ˆä¸ä¿å­˜ä»»ä½•è®°å½•ï¼‰

### 2.2 ç•Œé¢è®¾è®¡

#### 2.2.1 è®¾è®¡åŸåˆ™
- **æç®€ä¸»ä¹‰**: å‡å°‘è§†è§‰å¹²æ‰°ï¼Œçªå‡ºæ ¸å¿ƒåŠŸèƒ½
- **å“åº”å¼è®¾è®¡**: ç§»åŠ¨ç«¯ä¼˜å…ˆï¼Œè‡ªé€‚åº”å„ç§å±å¹•
- **æš—è‰²ä¸»é¢˜**: èµ›åšæœ‹å…‹ç¾å­¦ï¼Œä¿æŠ¤è§†åŠ›
- **å¾®äº¤äº’**: ç»†è…»çš„åŠ¨ç”»åé¦ˆ

#### 2.2.2 ä¸»ç•Œé¢å¸ƒå±€

```ascii
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Cyber Girlfriend               â”‚
â”‚   â— è¿æ¥çŠ¶æ€  00:45 ä¼šè¯æ—¶é•¿        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚         [éŸ³é¢‘æ³¢å½¢å¯è§†åŒ–åŒºåŸŸ]         â”‚
â”‚                                     â”‚
â”‚                                     â”‚
â”‚          â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®               â”‚
â”‚          â”‚   ğŸ™ï¸    â”‚               â”‚
â”‚          â”‚ æŒ‰ä½è¯´è¯ â”‚               â”‚
â”‚          â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯               â”‚
â”‚                                     â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âš™ï¸ è®¾ç½®  ğŸ“Š å†å²  ğŸ‘¤ äººæ ¼  â“ å¸®åŠ© â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2.2.3 è§†è§‰è§„èŒƒ

**é…è‰²æ–¹æ¡ˆ**
```css
/* èµ›åšæœ‹å…‹ä¸»é¢˜ */
--primary-bg: #0a0e27;      /* æ·±é‚ƒè“é»‘ */
--secondary-bg: #151933;     /* æ¬¡çº§èƒŒæ™¯ */
--accent-color: #00ffff;     /* éœ“è™¹é’è‰² */
--accent-pink: #ff00ff;      /* éœ“è™¹ç²‰è‰² */
--text-primary: #ffffff;     /* ä¸»æ–‡å­— */
--text-secondary: #8892b0;   /* æ¬¡è¦æ–‡å­— */
--error: #ff5555;           /* é”™è¯¯çº¢ */
--success: #50fa7b;         /* æˆåŠŸç»¿ */
```

**åŠ¨æ•ˆè®¾è®¡**
- éº¦å…‹é£æŒ‰é’®: æŒ‰ä¸‹æ—¶ç¼©æ”¾95%ï¼Œå‘å…‰æ•ˆæœ
- éŸ³é¢‘æ³¢å½¢: å®æ—¶é¢‘è°±æ˜¾ç¤ºï¼Œæ¸å˜è‰²å½©
- é¡µé¢åˆ‡æ¢: 0.3s ease-out è¿‡æ¸¡
- åŠ è½½çŠ¶æ€: è„‰å†²å‘¼å¸ç¯æ•ˆæœ

#### 2.2.4 è®¾ç½®é¢æ¿

**é¢æ¿ç»“æ„**
```
è®¾ç½®é¢æ¿ (ä¾§è¾¹æŠ½å±‰å¼)
â”œâ”€â”€ API é…ç½®
â”‚   â”œâ”€â”€ API Key è¾“å…¥æ¡†
â”‚   â”œâ”€â”€ ç«¯ç‚¹é€‰æ‹©
â”‚   â””â”€â”€ è¿æ¥æµ‹è¯•
â”œâ”€â”€ äººæ ¼è®¾ç½®
â”‚   â”œâ”€â”€ é¢„è®¾é€‰æ‹©
â”‚   â”œâ”€â”€ è‡ªå®šä¹‰ç¼–è¾‘å™¨
â”‚   â””â”€â”€ ä¿å­˜/åŠ è½½é…ç½®
â”œâ”€â”€ è¯­éŸ³è®¾ç½®
â”‚   â”œâ”€â”€ è¯­éŸ³æ¨¡å‹
â”‚   â”œâ”€â”€ è¯­é€Ÿæ§åˆ¶
â”‚   â””â”€â”€ éŸ³é‡è°ƒèŠ‚
â””â”€â”€ æ•°æ®ç®¡ç†
    â”œâ”€â”€ å¯¼å‡ºå¯¹è¯
    â”œâ”€â”€ æ¸…ç†æ•°æ®
    â””â”€â”€ å¤‡ä»½è®¾ç½®
```

---

## ä¸‰ã€æŠ€æœ¯æ¶æ„

### 3.1 æŠ€æœ¯é€‰å‹

#### å‰ç«¯æŠ€æœ¯æ ˆ
```yaml
æ¡†æ¶: React 18.2+
è¯­è¨€: TypeScript 5.0+
çŠ¶æ€ç®¡ç†: Zustand 4.4+
æ ·å¼æ–¹æ¡ˆ: TailwindCSS 3.4+
éŸ³é¢‘å¤„ç†: Web Audio API + MediaRecorder API
WebSocket: Native WebSocket API
æ„å»ºå·¥å…·: Vite 5.0+
ä»£ç è§„èŒƒ: ESLint + Prettier
æµ‹è¯•: Vitest + React Testing Library
```

#### åç«¯æŠ€æœ¯æ ˆ
```yaml
è¿è¡Œæ—¶: Node.js 20 LTS
æ¡†æ¶: Fastify 4.0+ (é«˜æ€§èƒ½)
è¯­è¨€: TypeScript 5.0+
WebSocket: ws 8.0+
APIé›†æˆ: OpenAI Node SDK 4.0+
æ•°æ®åº“: SQLite3 (è½»é‡çº§)
ç¼“å­˜: Node-cache (å†…å­˜ç¼“å­˜)
æ—¥å¿—: Pino (é«˜æ€§èƒ½æ—¥å¿—)
è¿›ç¨‹ç®¡ç†: PM2
```

### 3.2 ç³»ç»Ÿæ¶æ„å›¾

```mermaid
graph TB
    subgraph "å®¢æˆ·ç«¯"
        A[Webæµè§ˆå™¨] --> B[Reactåº”ç”¨]
        B --> C[WebSocketå®¢æˆ·ç«¯]
        B --> D[éŸ³é¢‘å¤„ç†æ¨¡å—]
    end
    
    subgraph "æœåŠ¡ç«¯"
        E[Nginxåå‘ä»£ç†] --> F[Node.jsæœåŠ¡å™¨]
        F --> G[WebSocketæœåŠ¡]
        F --> H[APIè·¯ç”±]
        G --> I[OpenAI Realtime API]
        H --> J[SQLiteæ•°æ®åº“]
        H --> K[ç¼“å­˜å±‚]
    end
    
    C -.->|WSS| E
    D -.->|éŸ³é¢‘æµ| C
```

### 3.3 APIè®¾è®¡

#### 3.3.1 WebSocketåè®®

**å»ºç«‹è¿æ¥**
```javascript
// å®¢æˆ·ç«¯å‘èµ·
{
  "type": "session.create",
  "data": {
    "api_key": "encrypted_key",
    "config": {
      "model": "gpt-4o-realtime-preview",
      "voice": "alloy",
      "instructions": "è‡ªå®šä¹‰æç¤ºè¯..."
    }
  }
}

// æœåŠ¡å™¨å“åº”
{
  "type": "session.created",
  "data": {
    "session_id": "uuid-v4",
    "expires_at": "2025-01-01T12:00:00Z"
  }
}
```

**éŸ³é¢‘æµä¼ è¾“**
```javascript
// å‘é€éŸ³é¢‘
{
  "type": "audio.append",
  "data": {
    "audio": "base64_encoded_pcm16",
    "sample_rate": 24000
  }
}

// æ¥æ”¶éŸ³é¢‘
{
  "type": "audio.delta",
  "data": {
    "audio": "base64_encoded_pcm16",
    "sequence": 1,
    "is_final": false
  }
}
```

#### 3.3.2 RESTful API

```yaml
# ä¼šè¯ç®¡ç†
POST   /api/v1/sessions          # åˆ›å»ºæ–°ä¼šè¯
GET    /api/v1/sessions/:id      # è·å–ä¼šè¯è¯¦æƒ…
DELETE /api/v1/sessions/:id      # ç»“æŸä¼šè¯

# å¯¹è¯å†å²
GET    /api/v1/conversations     # è·å–å¯¹è¯åˆ—è¡¨
GET    /api/v1/conversations/:id # è·å–å¯¹è¯è¯¦æƒ…
DELETE /api/v1/conversations/:id # åˆ é™¤å¯¹è¯
POST   /api/v1/conversations/export # æ‰¹é‡å¯¼å‡º

# é…ç½®ç®¡ç†
GET    /api/v1/settings          # è·å–ç”¨æˆ·è®¾ç½®
PUT    /api/v1/settings          # æ›´æ–°è®¾ç½®
GET    /api/v1/presets           # è·å–é¢„è®¾åˆ—è¡¨
POST   /api/v1/presets           # ä¿å­˜è‡ªå®šä¹‰é¢„è®¾

# ç³»ç»ŸçŠ¶æ€
GET    /api/v1/health            # å¥åº·æ£€æŸ¥
GET    /api/v1/metrics           # æ€§èƒ½æŒ‡æ ‡
```

### 3.4 æ•°æ®æ¨¡å‹

```sql
-- ä¼šè¯è¡¨
CREATE TABLE sessions (
    id UUID PRIMARY KEY,
    user_id VARCHAR(255),
    started_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ended_at TIMESTAMP,
    config JSON,
    status VARCHAR(50)
);

-- å¯¹è¯è®°å½•è¡¨
CREATE TABLE conversations (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    session_id UUID REFERENCES sessions(id),
    role VARCHAR(20),
    content TEXT,
    audio_url TEXT,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    metadata JSON
);

-- ç”¨æˆ·é…ç½®è¡¨
CREATE TABLE user_settings (
    user_id VARCHAR(255) PRIMARY KEY,
    api_key_encrypted TEXT,
    preferences JSON,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- é¢„è®¾æ¨¡æ¿è¡¨
CREATE TABLE presets (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(100),
    description TEXT,
    instructions TEXT,
    voice VARCHAR(50),
    is_public BOOLEAN DEFAULT FALSE,
    creator_id VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

## å››ã€éƒ¨ç½²æ–¹æ¡ˆ

### 4.1 Dockerå®¹å™¨åŒ–

**Dockerfile - åç«¯**
```dockerfile
FROM node:20-alpine

WORKDIR /app

# å®‰è£…ä¾èµ–
COPY package*.json ./
RUN npm ci --only=production

# å¤åˆ¶ä»£ç 
COPY . .

# æ„å»ºTypeScript
RUN npm run build

# æš´éœ²ç«¯å£
EXPOSE 8080

# å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD node healthcheck.js

# å¯åŠ¨åº”ç”¨
CMD ["node", "dist/index.js"]
```

**Docker Composeé…ç½®**
```yaml
version: '3.8'

services:
  backend:
    build: ./backend
    container_name: cyber-girlfriend-backend
    environment:
      NODE_ENV: production
      PORT: 8080
      DATABASE_PATH: /data/database.sqlite
    volumes:
      - ./data:/data
      - ./logs:/logs
    restart: unless-stopped
    networks:
      - cyber-network

  nginx:
    image: nginx:alpine
    container_name: cyber-girlfriend-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
      - ./frontend/dist:/usr/share/nginx/html
    depends_on:
      - backend
    restart: unless-stopped
    networks:
      - cyber-network

networks:
  cyber-network:
    driver: bridge

volumes:
  data:
  logs:
```

### 4.2 Nginxé…ç½®

```nginx
server {
    listen 443 ssl http2;
    server_name cyber-girlfriend.com;

    ssl_certificate /etc/nginx/ssl/cert.pem;
    ssl_certificate_key /etc/nginx/ssl/key.pem;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /usr/share/nginx/html;
        try_files $uri $uri/ /index.html;
        
        # ç¼“å­˜ç­–ç•¥
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
            expires 30d;
            add_header Cache-Control "public, immutable";
        }
    }

    # APIä»£ç†
    location /api/ {
        proxy_pass http://backend:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # WebSocketä»£ç†
    location /ws {
        proxy_pass http://backend:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # WebSocketè¶…æ—¶è®¾ç½®
        proxy_read_timeout 3600s;
        proxy_send_timeout 3600s;
    }
}

# HTTPé‡å®šå‘åˆ°HTTPS
server {
    listen 80;
    server_name cyber-girlfriend.com;
    return 301 https://$server_name$request_uri;
}
```

### 4.3 éƒ¨ç½²æµç¨‹

```bash
#!/bin/bash
# deploy.sh - è‡ªåŠ¨éƒ¨ç½²è„šæœ¬

# 1. æ‹‰å–æœ€æ–°ä»£ç 
git pull origin main

# 2. æ„å»ºå‰ç«¯
cd frontend
npm install
npm run build
cd ..

# 3. æ„å»ºåç«¯
cd backend
npm install
npm run build
cd ..

# 4. åœæ­¢æ—§å®¹å™¨
docker-compose down

# 5. æ„å»ºæ–°é•œåƒ
docker-compose build --no-cache

# 6. å¯åŠ¨æ–°å®¹å™¨
docker-compose up -d

# 7. å¥åº·æ£€æŸ¥
sleep 10
curl -f http://localhost/api/v1/health || exit 1

echo "éƒ¨ç½²æˆåŠŸï¼"
```

---

## äº”ã€éåŠŸèƒ½æ€§éœ€æ±‚

### 5.1 æ€§èƒ½è¦æ±‚

**å“åº”æ—¶é—´**
- é¦–æ¬¡è¯­éŸ³å“åº”: < 500ms
- APIå“åº”æ—¶é—´: < 200ms (P95)
- é¡µé¢åŠ è½½æ—¶é—´: < 2s
- WebSocketè¿æ¥å»ºç«‹: < 1s

**å¹¶å‘èƒ½åŠ›**
- æ”¯æŒå¹¶å‘ç”¨æˆ·: 100+
- æ¯ç”¨æˆ·WebSocketè¿æ¥: 1
- æ¶ˆæ¯ååé‡: 1000 msg/s

**èµ„æºå ç”¨**
- å†…å­˜ä½¿ç”¨: < 512MB (åç«¯)
- CPUä½¿ç”¨: < 50% (å•æ ¸)
- å¸¦å®½éœ€æ±‚: 128kbps/ç”¨æˆ·

### 5.2 å®‰å…¨è¦æ±‚

**æ•°æ®å®‰å…¨**
- APIå¯†é’¥åŠ å¯†: AES-256-GCM
- ä¼ è¾“åŠ å¯†: TLS 1.3
- æ•°æ®åº“åŠ å¯†: SQLCipher (å¯é€‰)
- å¯†ç ç­–ç•¥: bcrypt (cost=12)

**è®¿é—®æ§åˆ¶**
- JWTè®¤è¯ (å¯é€‰)
- é€Ÿç‡é™åˆ¶: 60è¯·æ±‚/åˆ†é’Ÿ
- IPç™½åå• (å¯é€‰)
- CORSç­–ç•¥é…ç½®

**å®‰å…¨å®¡è®¡**
- è®¿é—®æ—¥å¿—è®°å½•
- å¼‚å¸¸è¡Œä¸ºæ£€æµ‹
- æ•æ„Ÿæ“ä½œå®¡è®¡
- å®šæœŸå®‰å…¨æ‰«æ

### 5.3 å¯ç”¨æ€§è¦æ±‚

**ç³»ç»Ÿå¯ç”¨æ€§**
- ç›®æ ‡å¯ç”¨æ€§: 99.9%
- è®¡åˆ’ç»´æŠ¤çª—å£: æ¯æœˆ1æ¬¡ï¼Œ2å°æ—¶
- æ•…éšœæ¢å¤æ—¶é—´: < 5åˆ†é’Ÿ
- æ•°æ®å¤‡ä»½: æ¯æ—¥è‡ªåŠ¨å¤‡ä»½

**é”™è¯¯å¤„ç†**
- ä¼˜é›…çš„é”™è¯¯æç¤º
- è‡ªåŠ¨é‡è¯•æœºåˆ¶
- é™çº§ç­–ç•¥
- ç¦»çº¿æ¨¡å¼æ”¯æŒ

### 5.4 å¯æ‰©å±•æ€§

**æ°´å¹³æ‰©å±•**
- æ— çŠ¶æ€æœåŠ¡è®¾è®¡
- è´Ÿè½½å‡è¡¡æ”¯æŒ
- åˆ†å¸ƒå¼ç¼“å­˜å°±ç»ª
- æ•°æ®åº“è¯»å†™åˆ†ç¦»é¢„ç•™

**å‚ç›´æ‰©å±•**
- æ¨¡å—åŒ–æ¶æ„
- æ’ä»¶ç³»ç»Ÿé¢„ç•™
- APIç‰ˆæœ¬ç®¡ç†
- å¤šè¯­è¨€æ”¯æŒæ¡†æ¶

---

## å…­ã€ç§»åŠ¨ç«¯é€‚é…

### 6.1 å“åº”å¼Webè®¾è®¡

**æ–­ç‚¹è®¾è®¡**
```css
/* ç§»åŠ¨è®¾å¤‡ */
@media (max-width: 640px) {}

/* å¹³æ¿è®¾å¤‡ */
@media (min-width: 641px) and (max-width: 1024px) {}

/* æ¡Œé¢è®¾å¤‡ */
@media (min-width: 1025px) {}
```

**è§¦æ§ä¼˜åŒ–**
- æœ€å°è§¦æ§ç›®æ ‡: 44x44px (iOS) / 48x48dp (Android)
- æ‰‹åŠ¿æ”¯æŒ: æ»‘åŠ¨ã€é•¿æŒ‰ã€åŒå‡»
- é¿å…æ‚¬åœäº¤äº’
- æ”¯æŒè®¾å¤‡æ—‹è½¬

### 6.2 ç§»åŠ¨åº”ç”¨è§„åˆ’

**æŠ€æœ¯æ–¹æ¡ˆ**
- PWA (æ¸è¿›å¼Webåº”ç”¨): ç¬¬ä¸€é˜¶æ®µ
- React Native: ç¬¬äºŒé˜¶æ®µ (å¦‚éœ€åŸç”ŸåŠŸèƒ½)
- åŸç”Ÿå¼€å‘: ç¬¬ä¸‰é˜¶æ®µ (å¦‚éœ€æè‡´æ€§èƒ½)

**PWAç‰¹æ€§**
- Service Workerç¼“ç¦»çº¿æ”¯æŒ
- Appå›¾æ ‡å’Œå¯åŠ¨ç”»é¢
- æ¨é€é€šçŸ¥ (å¯é€‰)
- åå°åŒæ­¥

**åŸç”ŸåŠŸèƒ½é¢„ç•™**
- æœ¬åœ°é€šçŸ¥
- åå°éŸ³é¢‘æ’­æ”¾
- å¿«æ·æŒ‡ä»¤é›†æˆ
- ç³»ç»Ÿçº§è¯­éŸ³å”¤é†’

---

## ä¸ƒã€æµ‹è¯•æ–¹æ¡ˆ

### 7.1 æµ‹è¯•ç±»å‹

**å•å…ƒæµ‹è¯•**
- è¦†ç›–ç‡ç›®æ ‡: > 80%
- æµ‹è¯•æ¡†æ¶: Vitest
- Mockç­–ç•¥: MSW (APIæ¨¡æ‹Ÿ)

**é›†æˆæµ‹è¯•**
- APIç«¯åˆ°ç«¯æµ‹è¯•
- WebSocketè¿æ¥æµ‹è¯•
- æ•°æ®åº“æ“ä½œæµ‹è¯•

**æ€§èƒ½æµ‹è¯•**
- è´Ÿè½½æµ‹è¯•: K6
- å‹åŠ›æµ‹è¯•: æ‰¾å‡ºç³»ç»Ÿæé™
- é•¿æ—¶é—´è¿è¡Œæµ‹è¯•

**ç”¨æˆ·ä½“éªŒæµ‹è¯•**
- A/Bæµ‹è¯•æ¡†æ¶
- ç”¨æˆ·è¡Œä¸ºåˆ†æ
- å¯ç”¨æ€§æµ‹è¯•

### 7.2 æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹

```javascript
// è¯­éŸ³äº¤äº’æµ‹è¯•
describe('Voice Interaction', () => {
  test('åº”è¯¥åœ¨500mså†…å“åº”è¯­éŸ³è¾“å…¥', async () => {
    const startTime = Date.now();
    await sendAudioInput(testAudio);
    const response = await waitForResponse();
    const responseTime = Date.now() - startTime;
    expect(responseTime).toBeLessThan(500);
  });
  
  test('åº”è¯¥æ­£ç¡®å¤„ç†ç”¨æˆ·ä¸­æ–­', async () => {
    const promise = sendAudioInput(longAudio);
    await sleep(100);
    await interruptPlayback();
    const state = await getPlaybackState();
    expect(state).toBe('stopped');
  });
});
```

---

## å…«ã€ç›‘æ§ä¸è¿ç»´

### 8.1 ç›‘æ§æŒ‡æ ‡

**ä¸šåŠ¡æŒ‡æ ‡**
- æ—¥æ´»ç”¨æˆ· (DAU)
- å¹³å‡ä¼šè¯æ—¶é•¿
- å¯¹è¯è½®æ¬¡
- ç”¨æˆ·ç•™å­˜ç‡

**æŠ€æœ¯æŒ‡æ ‡**
- APIå“åº”æ—¶é—´
- é”™è¯¯ç‡
- WebSocketè¿æ¥æ•°
- å†…å­˜/CPUä½¿ç”¨ç‡

### 8.2 å‘Šè­¦è§„åˆ™

```yaml
alerts:
  - name: é«˜é”™è¯¯ç‡
    condition: error_rate > 5%
    duration: 5m
    severity: warning
    
  - name: æœåŠ¡ä¸å¯ç”¨
    condition: health_check_failure
    duration: 1m
    severity: critical
    
  - name: å†…å­˜ä½¿ç”¨è¿‡é«˜
    condition: memory_usage > 80%
    duration: 10m
    severity: warning
```

### 8.3 æ—¥å¿—ç­–ç•¥

**æ—¥å¿—çº§åˆ«**
- ERROR: ç³»ç»Ÿé”™è¯¯ã€å¼‚å¸¸
- WARN: æ€§èƒ½é—®é¢˜ã€é…ç½®é—®é¢˜
- INFO: ç”¨æˆ·æ“ä½œã€ç³»ç»Ÿäº‹ä»¶
- DEBUG: è¯¦ç»†è°ƒè¯•ä¿¡æ¯

**æ—¥å¿—æ ¼å¼**
```json
{
  "timestamp": "2025-01-01T12:00:00Z",
  "level": "INFO",
  "service": "cyber-girlfriend",
  "trace_id": "uuid",
  "user_id": "hash",
  "message": "Session created",
  "metadata": {}
}
```

---

## ä¹ã€é¡¹ç›®é‡Œç¨‹ç¢‘

### Phase 1: MVP (4å‘¨)
- [x] åŸºç¡€è¯­éŸ³äº¤äº’
- [x] OpenAI APIé›†æˆ
- [x] ç®€å•UIç•Œé¢
- [x] Dockeréƒ¨ç½²

### Phase 2: æ ¸å¿ƒåŠŸèƒ½ (4å‘¨)
- [ ] ä¸ªæ€§åŒ–è®¾ç½®
- [ ] å¯¹è¯å†å²
- [ ] æ•°æ®å¯¼å‡º
- [ ] é¢„è®¾æ¨¡æ¿

### Phase 3: ä¼˜åŒ–æå‡ (4å‘¨)
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] UIç¾åŒ–
- [ ] PWAæ”¯æŒ
- [ ] ç›‘æ§ç³»ç»Ÿ

### Phase 4: æ‰©å±•åŠŸèƒ½ (å¾…å®š)
- [ ] å¤šè¯­è¨€æ”¯æŒ
- [ ] æƒ…ç»ªè¯†åˆ«
- [ ] åœºæ™¯æ¨¡å¼
- [ ] ç¤¾åŒºåˆ†äº«

---

## åã€é£é™©è¯„ä¼°

### 10.1 æŠ€æœ¯é£é™©

| é£é™©é¡¹ | å¯èƒ½æ€§ | å½±å“ | ç¼“è§£æªæ–½ |
|--------|--------|------|----------|
| APIæˆæœ¬è¶…æ”¯ | ä¸­ | é«˜ | è®¾ç½®ä½¿ç”¨é™é¢ï¼Œä¼˜åŒ–è°ƒç”¨é¢‘ç‡ |
| å»¶è¿Ÿè¿‡é«˜ | ä¸­ | ä¸­ | è¾¹ç¼˜èŠ‚ç‚¹éƒ¨ç½²ï¼Œè¿æ¥æ± ä¼˜åŒ– |
| å¹¶å‘ç“¶é¢ˆ | ä½ | é«˜ | è´Ÿè½½å‡è¡¡ï¼Œé˜Ÿåˆ—ç³»ç»Ÿ |
| æ•°æ®æ³„éœ² | ä½ | é«˜ | åŠ å¯†å­˜å‚¨ï¼Œå®‰å…¨å®¡è®¡ |

### 10.2 åˆè§„é£é™©

- **å†…å®¹å®¡æ ¸**: å®æ–½å†…å®¹è¿‡æ»¤æœºåˆ¶
- **ç”¨æˆ·éšç§**: éµå¾ªGDPR/CCPA
- **å¹´é¾„é™åˆ¶**: å®æ–½å¹´é¾„éªŒè¯
- **ä½¿ç”¨æ¡æ¬¾**: æ˜ç¡®æœåŠ¡è¾¹ç•Œ

---

## åä¸€ã€æˆæœ¬é¢„ç®—

### 11.1 å¼€å‘æˆæœ¬
- å‰ç«¯å¼€å‘: 2äººæœˆ
- åç«¯å¼€å‘: 2äººæœˆ
- UI/UXè®¾è®¡: 1äººæœˆ
- æµ‹è¯•: 1äººæœˆ

### 11.2 è¿è¥æˆæœ¬ (æœˆåº¦)
- VPSæœåŠ¡å™¨: $20-50
- åŸŸå: $2
- SSLè¯ä¹¦: $0 (Let's Encrypt)
- OpenAI API: $50-200 (è§†ä½¿ç”¨é‡)
- å¤‡ä»½å­˜å‚¨: $5

### 11.3 ä¼˜åŒ–å»ºè®®
- ä½¿ç”¨Tokenç¼“å­˜å‡å°‘APIè°ƒç”¨
- å®æ–½æ™ºèƒ½å¯¹è¯æˆªæ–­
- æ‰¹é‡å¤„ç†è¯·æ±‚
- ä½¿ç”¨CDNåŠ é€Ÿé™æ€èµ„æº

---

## åäºŒã€é™„å½•

### A. å‚è€ƒèµ„æº
- [OpenAI Realtime APIæ–‡æ¡£](https://platform.openai.com/docs/guides/realtime)
- [WebSocketåè®®è§„èŒƒ](https://tools.ietf.org/html/rfc6455)
- [Web Audio API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API)
- [PWAæœ€ä½³å®è·µ](https://web.dev/progressive-web-apps/)

### B. æœ¯è¯­è¡¨
- **VAD**: Voice Activity Detectionï¼Œè¯­éŸ³æ´»åŠ¨æ£€æµ‹
- **PCM**: Pulse Code Modulationï¼Œè„‰å†²ç¼–ç è°ƒåˆ¶
- **JWT**: JSON Web Tokenï¼Œç”¨äºèº«ä»½éªŒè¯
- **PWA**: Progressive Web Appï¼Œæ¸è¿›å¼Webåº”ç”¨

### C. è”ç³»æ–¹å¼
- é¡¹ç›®è´Ÿè´£äºº: [å¾…å®š]
- æŠ€æœ¯æ”¯æŒ: [å¾…å®š]
- æ–‡æ¡£ç»´æŠ¤: [å¾…å®š]

---

*æœ¬æ–‡æ¡£å°†æŒç»­æ›´æ–°ï¼Œæœ€æ–°ç‰ˆæœ¬è¯·æŸ¥çœ‹é¡¹ç›®ä»“åº“ã€‚*

**æ–‡æ¡£ç‰ˆæœ¬å†å²**
- v1.0 (2025-01-XX): åˆå§‹ç‰ˆæœ¬
- v1.1 (å¾…å®š): å¢åŠ ç§»åŠ¨ç«¯è¯¦ç»†è§„åˆ’
- v1.2 (å¾…å®š): è¡¥å……APIç»†èŠ‚æ–‡æ¡£